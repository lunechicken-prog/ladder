<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ğŸ„ è–èª•äº¤æ›ç¦®ç‰©ï¼é¬¼è…³åœ– ğŸ</title>

<style>
html, body {
    margin: 0;
    padding: 0;
    overflow: hidden;
    overscroll-behavior: none;
    font-family: Arial, sans-serif;
    background: #f4f4f4;
    text-align: center;
}

h1 {
    margin: 10px 0;
    font-size: 20px;
    color: #c62828;
}

#top, #bottom {
    display: grid;
    grid-template-columns: repeat(17, 1fr);
    max-width: 100%;
    font-size: 16px;
    font-weight: bold;
    margin: 6px auto;
}

#top div {
    cursor: pointer;
}

#ladder-wrapper {
    position: relative;
    width: 100%;
    height: 75vh;
    overflow: hidden;
}

#ladder {
    position: relative;
    width: 100%;
    max-width: 700px;
    height: 900px;
    margin: 0 auto;
    background: #fff;
}

.vline {
    position: absolute;
    top: 0;
    bottom: 0;
    width: 2px;
    background: #333;
}

.hline {
    position: absolute;
    height: 4px;
    background: #333;
}

.player {
    position: absolute;
    width: 16px;
    height: 16px;
    background: #ffeb3b;
    border-radius: 50%;
    box-shadow: 0 0 8px rgba(0,0,0,0.4);
    transform: translate(-50%, -50%);
    transition: left 0.25s linear, top 0.25s linear;
    z-index: 10;
}

#result {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    padding: 10px 0;
    font-size: 20px;
    background: rgba(255,255,255,0.95);
    border-top: 1px solid #ccc;
    z-index: 100;
}
</style>
</head>

<body>

<h1>ğŸ„ è–èª•äº¤æ›ç¦®ç‰©ï¼é¬¼è…³åœ– ğŸ</h1>

<div id="top"></div>

<div id="ladder-wrapper">
    <div id="ladder"></div>
</div>

<div id="bottom"></div>

<div id="result"></div>

<script>
const COLS = 17;
const ROWS = 30;
const STEP_Y = 28;
const STORAGE_KEY = "ladder-fixed-v2";

const icons = ["ğŸ","ğŸ„","ğŸ…","â­","ğŸ°","ğŸº","ğŸ’","ğŸ‘‘","ğŸ§","ğŸ“±","ğŸ§¸","ğŸ·","ğŸ®","â˜•","ğŸ‚","ğŸ•¯ï¸","ğŸ‰"];

const topDiv = document.getElementById("top");
const bottomDiv = document.getElementById("bottom");
const ladder = document.getElementById("ladder");
const wrapper = document.getElementById("ladder-wrapper");
const result = document.getElementById("result");

let colCenters = [];
let hLines = [];

/* ä¸Šæ–¹ï¼šç¦®ç‰©åœ–æ¡ˆï¼ˆå¯é»ï¼‰ */
icons.forEach((icon, i) => {
    const d = document.createElement("div");
    d.innerText = icon;
    d.onclick = () => start(i);
    topDiv.appendChild(d);
});

/* ä¸‹æ–¹ï¼šäººå“¡æ•¸å­— */
for (let i = 1; i <= COLS; i++) {
    const d = document.createElement("div");
    d.innerText = i;
    bottomDiv.appendChild(d);
}

/* è¨ˆç®—æ¬„ä½ä¸­å¿ƒ */
function calcCols() {
    colCenters = [];
    const w = ladder.clientWidth;
    for (let i = 0; i < COLS; i++) {
        colCenters.push(w * (i + 0.5) / COLS);
    }
}

/* è®€å–æˆ–å»ºç«‹å›ºå®šæ¢¯å­ */
function loadLadder() {
    const saved = localStorage.getItem(STORAGE_KEY);
    if (saved) {
        hLines = JSON.parse(saved);
        return;
    }
    hLines = [];
    for (let r = 0; r < ROWS; r++) {
        hLines[r] = [];
        for (let c = 0; c < COLS - 1; c++) {
            if (Math.random() < 0.35 && !hLines[r][c - 1]) {
                hLines[r][c] = true;
            }
        }
    }
    localStorage.setItem(STORAGE_KEY, JSON.stringify(hLines));
}

/* ç•«æ¢¯å­ */
function drawLadder() {
    ladder.innerHTML = "";
    calcCols();

    colCenters.forEach(x => {
        const v = document.createElement("div");
        v.className = "vline";
        v.style.left = x + "px";
        ladder.appendChild(v);
    });

    for (let r = 0; r < ROWS; r++) {
        for (let c = 0; c < COLS - 1; c++) {
            if (hLines[r][c]) {
                const h = document.createElement("div");
                h.className = "hline";
                h.style.left = colCenters[c] + "px";
                h.style.top = (r * STEP_Y + 20) + "px";
                h.style.width = (colCenters[c + 1] - colCenters[c]) + "px";
                ladder.appendChild(h);
            }
        }
    }
}

/* åˆå§‹åŒ– */
loadLadder();
drawLadder();
window.addEventListener("resize", drawLadder);

/* å‹•ç•«ä¸»æµç¨‹ */
async function start(startCol) {
    ladder.querySelectorAll(".player").forEach(p => p.remove());
    result.innerText = "";

    let c = startCol;
    const p = document.createElement("div");
    p.className = "player";
    ladder.appendChild(p);

    p.style.left = colCenters[c] + "px";
    p.style.top = "0px";

    for (let r = 0; r < ROWS; r++) {
        await move(p, colCenters[c], r * STEP_Y + 20);

        if (c > 0 && hLines[r][c - 1]) {
            c--;
            await move(p, colCenters[c], r * STEP_Y + 20);
        } else if (hLines[r][c]) {
            c++;
            await move(p, colCenters[c], r * STEP_Y + 20);
        }
    }

    result.innerText = "ğŸ‰ çµæœå‡ºçˆï¼šç¦®ç‰© " + icons[startCol] + " â†’ ç¬¬ " + (c + 1) + " è™Ÿ";
}

/* è®“ç•«é¢è·Ÿè‘—åœ“é»èµ° */
function move(el, x, y) {
    return new Promise(res => {
        el.style.left = x + "px";
        el.style.top = y + "px";

        const targetScroll = y - wrapper.clientHeight / 2;
        wrapper.scrollTo({
            top: Math.max(targetScroll, 0),
            behavior: "smooth"
        });

        setTimeout(res, 260);
    });
}
</script>

</body>
</html>
